// Calculate 123456 * -987654
// The first operand is in 0000-0007, the second operand is in 0008-000F
// the result will be stored in A000-A007
// The carrying number is in 1000

main:
	LoadI R15, #56
	Save  [0x0000], R15
	LoadI R15, #34
	Save  [0x0001], R15
	LoadI R15, #12
	Save  [0x0002], R15

	LoadI R15, #54
	Save  [0x0008], R15
	LoadI R15, #76
	Save  [0x0009], R15
	LoadI R15, #98
	Save  [0x000A], R15
	LoadI R15, #1
	Save  [0x000E], R15

	LoadI R13, #0 				// Loop1 initialization

loop1:
	LoadI R15, #6
	Equal R13, R15				// Loop1 condition
	JmpC  process-carry

	LoadI R14, #0 				// Loop2 initialization

	loop2:
		LoadI R15, #6
		Equal R14, R15			// Loop2 initialization
		JmpC  loop1-inc

		LoadI R11, #0x0000
		Add   R11, R13
		LoadR R0, [R11]
		LoadI R11, #0x0008
		Add   R11, R14
		LoadR R1, [R11]
		Mul   R0, R1

		// carry
		LoadI R11, #100
		Move  R1, R0
		Div   R1, R11
		Move  R2, R0
		Mod   R2, R11

		LoadI R11, #0xA000
		Add   R11, R13
		Add	  R11, R14
		LoadR R0, [R11]
		Add   R0, R2
		SaveR [R11], R0
		LoadI R15, #1
		Add	  R11, R15
		LoadR R0, [R11]
		Add   R0, R1
		SaveR [R11], R0

		LoadI R15, #1
		Add   R14, R15			// Loop2 incrementation
		Jmp   loop2

loop1-inc:
	LoadI R15, #1
	Add   R13, R15			// Loop incrementation
	Jmp   loop1

process-carry:
	LoadI R14, #0

process-carry-loop:
	LoadI R15, #6
	Equal R14, R15
	JmpC  mul-sign

	LoadI R11, #0xA000
	Add   R11, R14
	LoadR R0, [R11]
	LoadI R11, #100
	Move  R1, R0
	Div   R1, R11
	Move  R2, R0
	Mod   R2, R11

	LoadI R11, #0xA000
	Add   R11, R14
	SaveR [R11], R2
	LoadI R15, #1
	Add   R11, R15
	LoadR R0, [R11]
	Add   R0, R1
	SaveR [R11], R0

	LoadI R15, #1
	Add   R14, R15			// Loop incrementation
	Jmp   process-carry-loop

mul-sign:
	Load  R0, [0x0006]
	Load  R1, [0x000E]
	Xor   R0, R1
	Save  [0xA006], R1


output:
%printm [0xA000]
%printm [0xA001]
%printm [0xA002]
%printm [0xA003]
%printm [0xA004]
%printm [0xA005]
%printm [0xA006]
%printm [0xA007]
	Exit









